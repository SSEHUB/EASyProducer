package iip.connectivity;
import java.io.IOException;

import de.iip_ecosphere.platform.connectors.ConnectorParameter;
import de.iip_ecosphere.platform.support.TimeUtils;
import de.iip_ecosphere.platform.transport.connectors.ReceptionCallback;
import de.iip_ecosphere.platform.transport.serialization.SerializerRegistry;

import de.iip_ecosphere.platform.connectors.modbustcpipv1.ModbusTcpIpConnector;

import iip.nodes.MyModbusSentronConnExample;
import iip.datatypes.ModbusSiemensRwSentron;
import iip.datatypes.ModbusSiemensSentron;

/**
 * Technical connection test for connector "myModbusSentronConn example".
 * Generated by: EASy-Producer.
 */
public class MyModbusSentronConnExampleTest {

    private static ReceptionCallback<ModbusSiemensRwSentron> callback
        = new ReceptionCallback<ModbusSiemensRwSentron>() {
    
        @Override
        public void received(ModbusSiemensRwSentron data) {
            System.out.println("Connector received: " + data);
        }
    
        @Override
        public Class<ModbusSiemensRwSentron> getType() {
            return ModbusSiemensRwSentron.class;
        }
    
    };

    /**
     * Main program.
     * 
     * @param args ignored
     * @throws IOException if intended connectivity fails
     */
    public static void main(String[] args) throws IOException {
        SerializerRegistry.registerSerializer(iip.serializers.ModbusSiemensSentronImpl.class);
        SerializerRegistry.registerSerializer(iip.serializers.ModbusSiemensSentron.class);
        SerializerRegistry.registerSerializer(iip.serializers.ModbusSiemensRwSentronImpl.class);
        SerializerRegistry.registerSerializer(iip.serializers.ModbusSiemensRwSentron.class);
        
        ConnectorParameter params = MyModbusSentronConnExample
            .createConnectorParameter(); // as configured, or create own and customize
            
        ModbusTcpIpConnector<ModbusSiemensRwSentron, ModbusSiemensSentron> conn = new ModbusTcpIpConnector<>(
            MyModbusSentronConnExample.createConnectorAdapter());
        Runtime.getRuntime().addShutdownHook(new Thread(() -> conn.disconnectSafe()));
        conn.connect(params);
        conn.setReceptionCallback(callback);
        System.out.println("Connector myModbusSentronConn example created...");

        // wait for data
        while (true) {
            TimeUtils.sleep(300);
        }
    }

}
