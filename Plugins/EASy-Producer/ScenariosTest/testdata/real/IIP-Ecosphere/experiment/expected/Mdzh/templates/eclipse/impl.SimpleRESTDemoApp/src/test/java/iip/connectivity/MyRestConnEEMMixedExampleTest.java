package iip.connectivity;

import java.io.IOException;

import de.iip_ecosphere.platform.connectors.ConnectorParameter;
import de.iip_ecosphere.platform.connectors.rest.RESTConnector;
import de.iip_ecosphere.platform.support.TimeUtils;
import de.iip_ecosphere.platform.transport.connectors.ReceptionCallback;
import de.iip_ecosphere.platform.transport.serialization.SerializerRegistry;

import iip.datatypes.RestPhoenixEEMMixed;
import iip.datatypes.RestPhoenixRwEEMMixed;
import iip.nodes.MyRestConnEEMMixedExample;
import iip.nodes.MyRestConnEEMMixedExampleImpl;
import iip.serializers.RestPhoenixEEMMixedImplSerializer;
import iip.serializers.RestPhoenixEEMMixedSerializer;
import iip.serializers.RestPhoenixRwEEMMixedImplSerializer;
import iip.serializers.RestPhoenixRwEEMMixedSerializer;

/**
 * Technical connection test for connector "myRestConnEEMMixed example".
 * Generated by: EASy-Producer.
 */
public class MyRestConnEEMMixedExampleTest {

    private static ReceptionCallback<RestPhoenixEEMMixed> callback = new ReceptionCallback<RestPhoenixEEMMixed>() {

        @Override
        public void received(RestPhoenixEEMMixed data) {
            System.out.println("Connector received: " + data);
        }

        @Override
        public Class<RestPhoenixEEMMixed> getType() {
            return RestPhoenixEEMMixed.class;
        }

    };

    /**
     * Main program.
     *
     * @param args ignored
     *
     * @throws IOException if intended connectivity fails
     */
    public static void main(String[] args) throws IOException {
        SerializerRegistry.registerSerializer(RestPhoenixEEMMixedImplSerializer.class);
        SerializerRegistry.registerSerializer(RestPhoenixEEMMixedSerializer.class);
        SerializerRegistry.registerSerializer(RestPhoenixRwEEMMixedImplSerializer.class);
        SerializerRegistry.registerSerializer(RestPhoenixRwEEMMixedSerializer.class);

        // as configured, or create own and customize
        ConnectorParameter params = MyRestConnEEMMixedExample.createConnectorParameter();

        RESTConnector<RestPhoenixEEMMixed, RestPhoenixRwEEMMixed> conn = new MyRestConnEEMMixedExampleImpl(
            MyRestConnEEMMixedExample.createConnectorAdapter());
        Runtime.getRuntime()
            .addShutdownHook(new Thread(() -> conn.disconnectSafe()));
        conn.connect(params);
        conn.setReceptionCallback(callback);
        System.out.println("Connector myRestConnEEMMixed example created...");

        // wait for data
        System.out.println("Requesting data until <CTRL>+C...");
        while (true) {
            TimeUtils.sleep(300);
        }
    }

}
