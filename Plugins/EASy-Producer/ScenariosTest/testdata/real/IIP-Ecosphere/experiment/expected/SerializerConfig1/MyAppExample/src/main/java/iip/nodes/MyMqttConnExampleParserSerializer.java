package iip.nodes;

import java.io.IOException;
import java.util.*;
import java.util.function.*;
import static de.iip_ecosphere.platform.support.function.IOVoidFunction.optional;
import de.iip_ecosphere.platform.support.function.*;
import de.iip_ecosphere.platform.transport.serialization.*;
import de.iip_ecosphere.platform.connectors.parser.InputParser.InputConverter;
import de.iip_ecosphere.platform.connectors.parser.InputParser.ParseResult;
import de.iip_ecosphere.platform.connectors.parser.*;
import de.iip_ecosphere.platform.connectors.formatter.OutputFormatter.OutputConverter;
import de.iip_ecosphere.platform.connectors.formatter.*;
import de.iip_ecosphere.platform.connectors.types.ChanneledConnectorOutputTypeAdapter.ChanneledSerializer;        
import iip.datatypes.*;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.core.JsonProcessingException;

/**
 * Parser/formatter connector serializer for MyConnPltfIn.
 * Generated by: EASy-Producer.
 */
public class MyMqttConnExampleParserSerializer implements ChanneledSerializer<MyConnPltfIn> {

    private JsonInputParser parser;
    private Map<String, Integer> mapping;
    private Supplier<String> pathSupplier;
    
    public MyMqttConnExampleParserSerializer(String encoding, Map<String, Integer> mapping, Supplier<String> pathSupplier) {
        this.mapping = mapping;
        this.pathSupplier = pathSupplier;
        parser = (JsonInputParser) ParserUtils.createInstance(
            MyMqttConnExampleParserSerializer.class.getClassLoader(), "JsonInputParser", encoding);
    }

    @Override             
    public MyConnPltfIn from(String channel, byte[] data) throws IOException {
        final String path = pathSupplier == null ? "" : pathSupplier.get();
        JsonInputParser.JsonParseResult pr = parser.parse(data);
        JsonInputParser.JsonInputConverter inConverter = parser.getConverter(); 
        MyConnPltfIn result = new MyConnPltfInImpl();
        JsonInputParser.JsonParseResult prArray1 = pr.stepInto(path + "nested", 2);
        MyNested[] array1 = new MyNested[prArray1.getArraySize()];
        for (int i = 0, size = prArray1.getArraySize(); i < size; i++) {
            JsonInputParser.JsonParseResult prElement = prArray1.stepInto("", i);
            array1[i] = new MyNestedImpl();
            
        array1[i].setState(inConverter.toString(prElement.getLocalData(path + "state", 0)));
            
            prElement.stepOut();
        }
        prArray1.stepOut();
        
        result.setNested(array1);
        
        return result;
    }

    @Override    
    public byte[] to(MyConnPltfIn source) throws IOException {
        final String path = pathSupplier == null ? "" : pathSupplier.get();
        return null;
    }

    @Override
    public MyConnPltfIn clone(MyConnPltfIn origin) throws IOException {
        return new MyConnPltfInImpl(origin);
    }

    @Override
    public Class<MyConnPltfIn> getType() {
        return MyConnPltfIn.class;
    }

}

