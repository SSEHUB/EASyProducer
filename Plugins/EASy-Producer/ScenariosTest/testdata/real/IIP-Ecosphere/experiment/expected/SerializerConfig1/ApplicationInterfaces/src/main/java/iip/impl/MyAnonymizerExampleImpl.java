package iip.impl;

import java.io.InputStream;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.ExecutionException;

import de.iip_ecosphere.platform.services.environment.AbstractService;
import de.iip_ecosphere.platform.services.environment.DataIngestor;
import de.iip_ecosphere.platform.services.environment.DefaultServiceImpl;
import de.iip_ecosphere.platform.services.environment.ParameterConfigurer;
import de.iip_ecosphere.platform.services.environment.ServiceKind;
import de.iip_ecosphere.platform.services.environment.YamlService;
import de.iip_ecosphere.platform.transport.serialization.TypeTranslators;

import iip.datatypes.Rec1;
import iip.interfaces.MyAnonymizerExampleInterface;

/**
 * IIP-Ecosphere supporting service implementation for 'myAnonymizer example'.
 * Generated by: EASy-Producer.
 */
public abstract class MyAnonymizerExampleImpl extends DefaultServiceImpl implements MyAnonymizerExampleInterface {


    private boolean passThrough = false;
    private List<DataIngestor<Rec1>> rec1Ingestors = new ArrayList<>();
    private Map<String, ParameterConfigurer<?>> paramConfigurers = new HashMap<>();

    /**
     * Fallback constructor setting most fields to "empty" default values.
     * 
     * @param kind the service kind
     */
    protected MyAnonymizerExampleImpl(ServiceKind kind) {
        super(kind);
        registerParameterConfigurers();
    }

    /**
     * Fallback constructor setting most fields to "empty" default values.
     * 
     * @param serviceId the id of the service
     * @param kind the service kind
     */
    protected MyAnonymizerExampleImpl(String serviceId, ServiceKind kind) {
        super(serviceId, kind);
        registerParameterConfigurers();
    }

    /**
    * Creates a service instance from YAML information.
    * 
    * @param yaml the service information as read from YAML
    */
    protected MyAnonymizerExampleImpl(YamlService yaml) {
        super(yaml);
        registerParameterConfigurers();
    }
    
    /**
    * Creates a service instance from a service id and a YAML artifact.
    * 
    * @param serviceId the id of the service
    * @param ymlFile the YML file containing the YAML artifact with the service descriptor
    */
    protected MyAnonymizerExampleImpl(String serviceId, InputStream ymlFile) {
        super(serviceId, ymlFile);
        registerParameterConfigurers();
    }
    
    @Override
    public ParameterConfigurer<?> getParameterConfigurer(String paramName) {
        return paramConfigurers.get(paramName);
    }
    
    @Override
    public Set<String> getParameterNames() {
        return paramConfigurers.keySet();
    }
    
    /**
    * Registers the configurers.
    */
    protected void registerParameterConfigurers() {
        AbstractService.addConfigurer(paramConfigurers, "passThrough", Boolean.class, TypeTranslators.BOOLEAN, v -> 
            setParameterPassThrough(v), () -> getParameterPassThrough(), "iip.app.sc1.passThrough");
    }

    /**
    * Changes the service parameter "passThrough".
    *
    * @param passThrough the parameter value
    * 
    * @throws ExecutionException if setting the value fails, e.g., as the service is in the wrong state such as startup
    * vs. runtime
    */
    public void setParameterPassThrough(boolean passThrough) throws ExecutionException {
        this.passThrough = passThrough;
    }
    /**
    * Returns the service parameter "passThrough".
    *
    * @return the value of the parameter
    */
    public boolean getParameterPassThrough() {
        return this.passThrough;
    }
    
    @Override
    public void attachRec1Ingestor(DataIngestor<Rec1> ingestor) {
        if (ingestor != null) {
            rec1Ingestors.add(ingestor);
        }
    }
    
    /**
    * Returns whether there are registered Rec1 ingestors.
    *
    * @return {@code true} if there are Rec1 ingestors, {@code false} else
    */
    protected boolean hasRec1Ingestor() {
        return rec1Ingestors.size() > 0;
    }
    
    /**
    * Returns the number of registered Rec1 ingestors.
    *
    * @return the number of Rec1 ingestors
    */
    protected int hasRec1IngestorCount() {
        return rec1Ingestors.size();
    }
    
    /**
    * Sends {@code data} to all registered Rec1 ingestors.
    *
    * @param data the data to be sent
    */
    protected void ingestRec1(Rec1 data) {
        for (int i = 0; i < rec1Ingestors.size(); i++) {
            rec1Ingestors.get(i)
                .ingest(data);
        }
    }

}
